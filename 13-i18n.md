# i18n
Moving forward with new country releases, it's important to excel in making clients feel at home using Tilt. We depend on the user's locale (ll-RR), a piece of data consisting of their language (ll), and optionally region (RR). 

On desktop, locale detection is priority based. Starting with highest priority:

1. The query parameter 'locale'.
2. Locale on the user logged in.
3. HTTP Accept-Language header. A browser sets this for all requests going out, usually based on the settings defined in the browser, but some use OS settings (IE). Some browsers like Safari may send only one, others may send a list in order of preferences. Many browsers will only send language without region (e.g. 'nl'), so we have to end up making a guess on their region.
4. Default en-US locale.

On mobile, locale detection is based solely on device settings, but this won't be discussed here.

## Formatting
Our goal is to transform every raw value representing time, monetary amount, or integer number, into something a user can recognize as being formatted according to their locale. Examples (for Dutch Netherlands locale):

1. MS since epoch ```1440275194871``` into ```zaterdag 22 augustus 2015 16:26```
2. Monetary USD amount in cents ```123400067``` into ```US$Â 1.234.000,67```
3. Integer value ```1234``` into ```1.234```

In the future, this list will expand to contain formatting of geographical addresses, phone numbers, names, and more.

### General
At the moment, we rely on an implementation (https://github.com/andyearnshaw/Intl.js/) of the standard Javascript object ```Intl``` for formatting currencies and numbers. ```Intl``` is based on ECMA-402 specifications, and although implementation and locale data differs between browsers, a consistent API is something we'll hopefully see eventually. Until then, we'll be using the polyfill in every browser for consistency.

Few things:
* Our formatter utilities and moment localized formatting will use global client locale if not provided explicitly, although you should be explicit as much as you can
* Do not use ```Intl``` or ```IntlPolyfill``` directly (either through the constructors or ```toLocaleString```)
* Our formatter utilities (below) cache constructors and provide an API that establishes consistency
* Do not use ```accounting.js``` as it is not based on locale and relies on the programmer to figure out the symbols, placement of symbols, groupings, decimal seperator, and so forth

### Currencies
* Currency formatters will always take cent amounts unless specified otherwise
* Use our ```CurrencyFormatter``` utilities to format currencies
    * ```formatCurrencyForDisplay``` which will not show decimals if not necessary
    * ```formatCurrency``` which will show decimals regardless
* In React, we have several components for currency formatting (which use the above internally):
    * ```Price``` an all purpose component which can take any currency code and any locale
    * ```UserPrice``` formats according to user's native currency and locale
    * ```CampaignPrice``` formats according to a Tilt's currency and user's locale
    * ```CountryPrice``` formats according to a countries native currency and user's locale

### Numbers
* Use our ```NumberFormatter``` utilities to format numbers as integers or real numbers 
    * ```formatNumberAsInteger```
    * ```formatNumberWithPrecision```
* In React, you may use ```LocalizedNumber``` component that uses the formatter internally

### Dates
```moment.js``` provides a lot of power in terms of working with dates in general, supports localized formatting and 'time ago' strings. ```Intl``` is pretty limited here, so we won't be using it.
* Use ```moment.js``` for for any formatting make sure to use localized formats (e.g. ```moment(date).format('L');``` vs ```moment(date).format('MM dd');```

## Other Localization
### Images
At the moment, images are localized based on user's country only and locale is not involved (likely to change)
* In React, use the ```LocalizedImage``` component to render localized images. It is primitive however, and follows an approach Android uses with localizing image resources.

### User Inputs
If a user is shown the value ```1.000,50```, he or she likely expects to enter such numerical values in the same manner.
* Use ```LocalizedNumberInput``` to replace ```<input lang="ll-RR" type="number"/>``` which many browsers do not support yet
* Use ```LocalizedFloatField``` to replace the ```FloatField``` field widget in newforms.

